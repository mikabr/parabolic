---
title: "Parabolic Art"
author: "Mika Braginsky"
output: html_document
---

```{r, echo=FALSE, warning=FALSE, message=FALSE}
library(ggplot2)
library(dplyr)
library(purrr)

colors <- c(magenta = "#d33682",
            red = "#dc322f",
            orange = "#cb4b16",
            yellow = "#b58900", 
            green = "#859900",
            cyan = "#2aa198",
            blue = "#268bd2",
            violet = "#6c71c4",
            purple = "#993399")
names(colors) <- NULL

n <- 14
cols <- seq(1, n/2)

sector <- data.frame(
  y = c(0, n, seq(n, 1)),
  yend = c(0, 0, rep(0, n)),
  x = c(n, 0, rep(0, n)),
  xend = c(0, 0, seq(1, n)),
  color = c(0, 0, c(cols, rev(cols)))
)

diamond <- data.frame(
  y = c(0, n, seq(n, 1), seq(n, 1), seq(-n, -1), seq(-n, -1)),
  yend = c(0, -n, rep(rep(0, n), 4)),
  x = c(n, 0, rep(rep(0, n), 4)),
  xend = c(-n, 0, seq(1, n), seq(-1, -n), seq(1, n), seq(-1, -n)),
  color = c(0, 0, rep(c(cols, rev(cols)), 4))
)

square <- data.frame(
  y = c(0, n, n, n, seq(n, 1), seq(n, 1)),
  yend = c(0, 0, n, 0, rep(0, n), rep(n, n)),
  x = c(n, 0, n, n, rep(0, n), rep(n, n)),
  xend = c(0, 0, 0, n, seq(1, n), seq(1, n)),
  color = c(0, 0, 0, 0, c(cols, rev(cols)), c(cols, rev(cols)))
)

translate <- function(data, dx, dy) {
  mutate(data,
         x = x + dx, xend = xend + dx,
         y = y + dy, yend = yend + dy)
}

rotate <- function(data, theta) {
  rot.coords <- matrix(c(cos(theta), -sin(theta), sin(theta), cos(theta)), ncol = 2,
                dimnames = list(NULL, c("x", "y")))
  rot.ends <- matrix(c(cos(theta), -sin(theta), sin(theta), cos(theta)), ncol = 2,
                       dimnames = list(NULL, c("xend", "yend")))
  rot.data <- bind_cols(as.data.frame(as.matrix(select(data, x, y)) %*% rot.coords),
                        as.data.frame(as.matrix(select(data, xend, yend)) %*% rot.ends),
                        select(data, color))
}

blank <- theme(axis.line = element_blank(),
               axis.text.x = element_blank(),
               axis.text.y = element_blank(),
               axis.ticks = element_blank(),
               axis.title.x = element_blank(),
               axis.title.y = element_blank(),
               legend.position = "none",
               panel.background = element_blank(),
               panel.border = element_blank(),
               panel.grid.major = element_blank(),
               panel.grid.minor = element_blank(),
               plot.background = element_blank())

plt <- function(data) {
  ggplot() +
    geom_segment(aes(x = x, xend = xend, y = y, yend = yend, color = factor(color)),
                 data = data, size = 0.3) +
    scale_color_manual(values = colors) +
    coord_fixed() +
    blank
}

row <- function(data, k) {
  bind_rows(map(seq(-k+1, k-1, by = 2), function(x) translate(data, x*n, 0)))
}

bottom.pyramid <- function(data, base) {
  bind_rows(map(seq(1, base), function(w) translate(row(data, w), 0, (w-1)*n)))
}

top.pyramid <- function(data, base) {
  bind_rows(map(seq(1, base), function(w) translate(row(data, w), 0, -(w-1)*n)))
}


meta.diamond <- function(data, maxw) {
  bind_rows(bottom.pyramid(data, maxw), translate(top.pyramid(data, maxw-1), 0, (maxw+maxw-2)*n))
}

plt(sector)
plt(square)
plt(diamond)
plt(rotate(diamond, pi/4))
plt(row(diamond, 3))
plt(top.pyramid(diamond, 2))
plt(meta.diamond(diamond, 3))
plt(meta.diamond(diamond, 5))
#ggsave(plt(meta.diamond(diamond, 5)), file = "meta.diamond.5.pdf", width = 36, height = 36, dpi = 600)
```